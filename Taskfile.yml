# daemon-tuis/Taskfile.yml
# Unified Build System for R2k Daemon Services
# https://taskfile.dev

version: '3'

silent: true

vars:
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ GLOBAL CONFIGURATION
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  BIN_DIR:
    sh: powershell -Command "(Get-Location).Path + '\assets\bin'"

  # Date/Time for ldflags (Windows format)
  DATE:
    sh: powershell -Command "Get-Date -Format 'yyyy-MM-dd'"
  TIME:
    sh: powershell -Command "Get-Date -Format 'HH:mm:ss'"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ท๏ธ NAMING CONVENTION: R2k_<<Daemon>><<Type>>_<<Env>>.exe
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # Scale (Bascula)
  SCALE_CONSOLE_LOCAL: "R2k_BasculaConsole_Local.exe"
  SCALE_CONSOLE_REMOTE: "R2k_BasculaConsole_Remoto.exe"
  SCALE_SERVICE_LOCAL: "R2k_BasculaServicio_Local.exe"
  SCALE_SERVICE_REMOTE: "R2k_BasculaServicio_Remoto.exe"

  # Ticket
  TICKET_CONSOLE_LOCAL: "R2k_TicketConsole_Local.exe"
  TICKET_CONSOLE_REMOTE: "R2k_TicketConsole_Remoto.exe"
  TICKET_SERVICE_LOCAL: "R2k_TicketServicio_Local.exe"
  TICKET_SERVICE_REMOTE: "R2k_TicketServicio_Remoto.exe"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ง LDFLAGS CONFIGURATION
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # Scale uses 'main' package variables
  LDFLAGS_SCALE_BASE: "-s -w -X main.BuildDate={{.DATE}} -X main.BuildTime={{.TIME}}"

  # Ticket uses internal/daemon package path
  TICKET_MODULE: "github.com/adcondev/ticket-daemon/internal/daemon"
  LDFLAGS_TICKET_BASE: "-s -w -X {{.TICKET_MODULE}}.BuildDate={{.DATE}} -X {{.TICKET_MODULE}}.BuildTime={{.TIME}}"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ช SERVICE IDENTIFIERS (Windows Service Registry Names)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # Scale
  SCALE_SVC_ID_LOCAL: "R2k_BasculaServicio_Local"
  SCALE_SVC_ID_REMOTE: "R2k_BasculaServicio_Remoto"
  SCALE_CMD_ID_LOCAL: "R2k_BasculaCmd_Local"
  SCALE_CMD_ID_REMOTE: "R2k_BasculaCmd_Remoto"
  SCALE_SVC_DISPLAY_REMOTE: "R2k Bascula Servicio (REMOTO)"
  SCALE_SVC_DESC_REMOTE: "Servicio de comunicaciรณn con bascula via WebSocket"

  # Ticket
  TICKET_SVC_ID_REMOTE: "R2k_TicketServicio_Remoto"
  TICKET_SVC_DISPLAY_REMOTE: "R2k Ticket Servicio (REMOTO)"
  TICKET_SVC_DESC_REMOTE: "Servicio de impresiรณn de tickets POS via WebSocket"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ฏ INSTALLER CONFIGURATION
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # Base Names (injected into config package)
  SCALE_BASE: "R2k_Bascula"
  TICKET_BASE: "R2k_Ticket"

  # Installer paths
  ASSETS_BIN_DIR:
    sh: powershell -Command "(Get-Location).Path + '\internal\assets\bin'"
  DIST_DIR:
    sh: powershell -Command "(Get-Location).Path + '\dist'"

  # Source repositories
  SCALE_SRC: "../scale-daemon"
  TICKET_SRC: "../ticket-daemon"

  # Installer ldflags
  CONFIG_PKG: "github.com/adcondev/poster-tuis/internal/config"
  LDFLAGS_INSTALLER: "-s -w -X '{{.CONFIG_PKG}}.BuildDate={{.DATE}}' -X '{{.CONFIG_PKG}}.BuildTime={{.TIME}}' -X '{{.CONFIG_PKG}}.ScaleBaseName={{.SCALE_BASE}}' -X '{{.CONFIG_PKG}}.TicketBaseName={{.TICKET_BASE}}'"

env:
  CGO_ENABLED: '0'
  GOOS: windows
  GOARCH: amd64

tasks:
  default:
    desc: "๐ Show all available tasks"
    cmds:
      - |
        echo
        echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        echo   DAEMON-TUIS - Unified Build System
        echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        echo
        echo   INDIVIDUAL BUILDS:
        echo     task scale:all         Build all Scale binaries
        echo     task ticket:all        Build all Ticket binaries
        echo
        echo   AGGREGATE BUILDS:
        echo     task build:all         Build EVERYTHING
        echo     task build:local       Build all LOCAL versions
        echo     task build:remote      Build all REMOTE versions
        echo     task build:console     Build all CONSOLE versions
        echo     task build:service     Build all SERVICE versions
        echo
        echo   ๐ฆ INSTALLER:
        echo     task installer:build   Build TUI Installer
        echo     task installer:rebuild Clean + rebuild installer
        echo
        echo   SERVICE MANAGEMENT - Requires Administrator:
        echo     task svc:install       Install all REMOTE services
        echo     task svc:uninstall     Uninstall all REMOTE services
        echo     task svc:start         Start all REMOTE services
        echo     task svc:stop          Stop all REMOTE services
        echo     task svc:restart       Restart all REMOTE services
        echo     task svc:status        Check status of all REMOTE services
        echo.
        echo   UTILITIES:
        echo     task clean             Remove bin directory
        echo     task clean:installer   Remove installer artifacts
        echo     task clean:all         Clean all project directories
        echo     task list              Show all tasks with descriptions
        echo.

  list:
    desc: "๐ List all tasks with descriptions"
    cmds:
      - task --list-all

  init:
    desc: "๐๏ธ Create bin directory"
    internal: true
    cmds:
      - powershell -Command "if (!(Test-Path '{{.BIN_DIR}}')) { New-Item -ItemType Directory -Path '{{.BIN_DIR}}' -Force | Out-Null }"
    status:
      - test -d "{{.BIN_DIR}}"

  init:assets:
    desc: "๐๏ธ Create internal/assets/bin directory"
    internal: true
    cmds:
      - powershell -Command "if (!(Test-Path '{{.ASSETS_BIN_DIR}}')) { New-Item -ItemType Directory -Path '{{.ASSETS_BIN_DIR}}' -Force | Out-Null }"
    status:
      - test -d "{{.ASSETS_BIN_DIR}}"

  init:dist:
    desc: "๐๏ธ Create dist directory"
    internal: true
    cmds:
      - powershell -Command "if (!(Test-Path '{{.DIST_DIR}}')) { New-Item -ItemType Directory -Path '{{.DIST_DIR}}' -Force | Out-Null }"
    status:
      - test -d "{{.DIST_DIR}}"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # โ๏ธ SCALE DAEMON (BASCULA)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  scale:console:local:
    desc: "โ๏ธ Build Scale Console (Local)"
    dir: ../scale-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -X main.BuildEnvironment=local -X main.ServiceName={{.SCALE_CMD_ID_LOCAL}}" -o "{{.BIN_DIR}}/{{.SCALE_CONSOLE_LOCAL}}" ./cmd/BasculaServicio
      - echo "โ Built {{.SCALE_CONSOLE_LOCAL}}"

  scale:console:remote:
    desc: "โ๏ธ Build Scale Console (Remote)"
    dir: ../scale-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -X main.BuildEnvironment=remote -X main.ServiceName={{.SCALE_CMD_ID_REMOTE}}" -o "{{.BIN_DIR}}/{{.SCALE_CONSOLE_REMOTE}}" ./cmd/BasculaServicio
      - echo "โ Built {{.SCALE_CONSOLE_REMOTE}}"

  scale:console:
    desc: "โ๏ธ Build all Scale Console binaries"
    cmds:
      - task: scale:console:local
      - task: scale:console:remote

  scale:service:local:
    desc: "โ๏ธ Build Scale Service (Local) [windowsgui]"
    dir: ../scale-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -H=windowsgui -X main.BuildEnvironment=local -X main.ServiceName={{.SCALE_SVC_ID_LOCAL}}" -o "{{.BIN_DIR}}/{{.SCALE_SERVICE_LOCAL}}" ./cmd/BasculaServicio
      - echo "โ Built {{.SCALE_SERVICE_LOCAL}}"

  scale:service:remote:
    desc: "โ๏ธ Build Scale Service (Remote) [windowsgui]"
    dir: ../scale-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -H=windowsgui -X main.BuildEnvironment=remote -X main.ServiceName={{.SCALE_SVC_ID_REMOTE}}" -o "{{.BIN_DIR}}/{{.SCALE_SERVICE_REMOTE}}" ./cmd/BasculaServicio
      - echo "โ Built {{.SCALE_SERVICE_REMOTE}}"

  scale:service:
    desc: "โ๏ธ Build all Scale Service binaries"
    cmds:
      - task: scale:service:local
      - task: scale:service:remote

  scale:all:
    desc: "โ๏ธ Build ALL Scale binaries (4 total)"
    cmds:
      - task: scale:console
      - task: scale:service
      - echo "โ All Scale binaries complete"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ซ TICKET DAEMON
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ticket:console:local:
    desc: "๐ซ Build Ticket Console (Local/Test)"
    dir: ../ticket-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -X {{.TICKET_MODULE}}.BuildEnvironment=test" -o "{{.BIN_DIR}}/{{.TICKET_CONSOLE_LOCAL}}" ./cmd/TicketServicio
      - echo "โ Built {{.TICKET_CONSOLE_LOCAL}}"

  ticket:console:remote:
    desc: "๐ซ Build Ticket Console (Remote/Prod)"
    dir: ../ticket-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -X {{.TICKET_MODULE}}.BuildEnvironment=prod" -o "{{.BIN_DIR}}/{{.TICKET_CONSOLE_REMOTE}}" ./cmd/TicketServicio
      - echo "โ Built {{.TICKET_CONSOLE_REMOTE}}"

  ticket:console:
    desc: "๐ซ Build all Ticket Console binaries"
    cmds:
      - task: ticket:console:local
      - task: ticket:console:remote

  ticket:service:local:
    desc: "๐ซ Build Ticket Service (Local/Test) [windowsgui]"
    dir: ../ticket-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -H=windowsgui -X {{.TICKET_MODULE}}.BuildEnvironment=test" -o "{{.BIN_DIR}}/{{.TICKET_SERVICE_LOCAL}}" ./cmd/TicketServicio
      - echo "โ Built {{.TICKET_SERVICE_LOCAL}}"

  ticket:service:remote:
    desc: "๐ซ Build Ticket Service (Remote/Prod) [windowsgui]"
    dir: ../ticket-daemon
    deps: [ init ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -H=windowsgui -X {{.TICKET_MODULE}}.BuildEnvironment=prod" -o "{{.BIN_DIR}}/{{.TICKET_SERVICE_REMOTE}}" ./cmd/TicketServicio
      - echo "โ Built {{.TICKET_SERVICE_REMOTE}}"

  ticket:service:
    desc: "๐ซ Build all Ticket Service binaries"
    cmds:
      - task: ticket:service:local
      - task: ticket:service:remote

  ticket:all:
    desc: "๐ซ Build ALL Ticket binaries (4 total)"
    cmds:
      - task: ticket:console
      - task: ticket:service
      - echo "โ All Ticket binaries complete"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ฆ AGGREGATE COMMANDS
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  build:all:
    desc: "๐๏ธ Build EVERYTHING (8 binaries)"
    cmds:
      - task: scale:all
      - task: ticket:all
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ BUILD COMPLETE - 8 binaries in ./bin"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

  build:local:
    desc: "๐ Build all LOCAL versions (Scale + Ticket)"
    cmds:
      - task: scale:console:local
      - task: scale:service:local
      - task: ticket:console:local
      - task: ticket:service:local
      - echo "โ All LOCAL binaries complete"

  build:remote:
    desc: "๐ Build all REMOTE versions (Scale + Ticket)"
    cmds:
      - task: scale:console:remote
      - task: scale:service:remote
      - task: ticket:console:remote
      - task: ticket:service:remote
      - echo "โ All REMOTE binaries complete"

  build:console:
    desc: "๐ฅ๏ธ Build all CONSOLE versions (Scale + Ticket)"
    cmds:
      - task: scale:console
      - task: ticket:console
      - echo "โ All CONSOLE binaries complete"

  build:service:
    desc: "โ๏ธ Build all SERVICE versions (Scale + Ticket)"
    cmds:
      - task: scale:service
      - task: ticket:service
      - echo "โ All SERVICE binaries complete"

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ช SERVICE MANAGEMENT (REMOTE) - Requires Administrator
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # SCALE SERVICE MANAGEMENT
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  svc:scale:install:
    desc: "โ๏ธ Install Scale Service (Remote) - Requires Admin"
    deps: [ scale:service:remote ]
    cmds:
      - cmd: sc stop {{.SCALE_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - cmd: sc delete {{.SCALE_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      # SECURE: Added escaped quotes \"...\" around path to prevent Unquoted Service Path vulnerability
      - sc create {{.SCALE_SVC_ID_REMOTE}} binPath= "\"{{.BIN_DIR}}\{{.SCALE_SERVICE_REMOTE}}\"" start= auto DisplayName= "{{.SCALE_SVC_DISPLAY_REMOTE}}"
      - sc description {{.SCALE_SVC_ID_REMOTE}} "{{.SCALE_SVC_DESC_REMOTE}}"
      - sc start {{.SCALE_SVC_ID_REMOTE}}
      - echo ""
      - echo "โ Scale Service installed and started"
      - echo "   Service ID:{{.SCALE_SVC_ID_REMOTE}}"

  svc:scale:uninstall:
    desc: "โ๏ธ Uninstall Scale Service (Remote) - Requires Admin"
    cmds:
      - cmd: sc stop {{.SCALE_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - cmd: powershell -Command "Start-Sleep -Seconds 2"
      - sc delete {{.SCALE_SVC_ID_REMOTE}}
      - echo "โ Scale Service uninstalled"

  svc:scale:start:
    desc: "โ๏ธ Start Scale Service (Remote)"
    cmds:
      - sc start {{.SCALE_SVC_ID_REMOTE}}
      - echo "โ Scale Service started"

  svc:scale:stop:
    desc: "โ๏ธ Stop Scale Service (Remote)"
    cmds:
      - sc stop {{.SCALE_SVC_ID_REMOTE}}
      - echo "โ Scale Service stopped"

  svc:scale:restart:
    desc: "โ๏ธ Restart Scale Service (Remote)"
    cmds:
      - cmd: sc stop {{.SCALE_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - powershell -Command "Start-Sleep -Seconds 2"
      - sc start {{.SCALE_SVC_ID_REMOTE}}
      - echo "โ Scale Service restarted"

  svc:scale:status:
    desc: "โ๏ธ Check Scale Service status"
    cmds:
      - sc query {{.SCALE_SVC_ID_REMOTE}}

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # TICKET SERVICE MANAGEMENT
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  svc:ticket:install:
    desc: "๐ซ Install Ticket Service (Remote) - Requires Admin"
    deps: [ ticket:service:remote ]
    cmds:
      - cmd: sc stop {{.TICKET_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - cmd: sc delete {{.TICKET_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      # SECURE: Added escaped quotes \"...\" around path
      - sc create {{.TICKET_SVC_ID_REMOTE}} binPath= "\"{{.BIN_DIR}}\{{.TICKET_SERVICE_REMOTE}}\"" start= auto DisplayName= "{{.TICKET_SVC_DISPLAY_REMOTE}}"
      - sc description {{.TICKET_SVC_ID_REMOTE}} "{{.TICKET_SVC_DESC_REMOTE}}"
      - sc start {{.TICKET_SVC_ID_REMOTE}}
      - echo ""
      - echo "โ Ticket Service installed and started"
      - echo "   Service ID:{{.TICKET_SVC_ID_REMOTE}}"

  svc:ticket:uninstall:
    desc: "๐ซ Uninstall Ticket Service (Remote) - Requires Admin"
    cmds:
      - cmd: sc stop {{.TICKET_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - cmd: powershell -Command "Start-Sleep -Seconds 2"
      - sc delete {{.TICKET_SVC_ID_REMOTE}}
      - echo "โ Ticket Service uninstalled"

  svc:ticket:start:
    desc: "๐ซ Start Ticket Service (Remote)"
    cmds:
      - sc start {{.TICKET_SVC_ID_REMOTE}}
      - echo "โ Ticket Service started"

  svc:ticket:stop:
    desc: "๐ซ Stop Ticket Service (Remote)"
    cmds:
      - sc stop {{.TICKET_SVC_ID_REMOTE}}
      - echo "โ Ticket Service stopped"

  svc:ticket:restart:
    desc: "๐ซ Restart Ticket Service (Remote)"
    cmds:
      - cmd: sc stop {{.TICKET_SVC_ID_REMOTE}} 2>nul
        ignore_error: true
      - powershell -Command "Start-Sleep -Seconds 2"
      - sc start {{.TICKET_SVC_ID_REMOTE}}
      - echo "โ Ticket Service restarted"

  svc:ticket:status:
    desc: "๐ซ Check Ticket Service status"
    cmds:
      - sc query {{.TICKET_SVC_ID_REMOTE}}

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # AGGREGATE SERVICE MANAGEMENT (ALL REMOTE SERVICES)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  svc:install:
    desc: "๐ Install ALL Remote Services - Requires Admin"
    cmds:
      - task: svc:scale:install
      - task: svc:ticket:install
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ ALL SERVICES INSTALLED"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

  svc:uninstall:
    desc: "๐๏ธ Uninstall ALL Remote Services - Requires Admin"
    cmds:
      - task: svc:scale:uninstall
      - task: svc:ticket:uninstall
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ ALL SERVICES UNINSTALLED"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

  svc:start:
    desc: "โถ๏ธ Start ALL Remote Services"
    cmds:
      - task: svc:scale:start
      - task: svc:ticket:start
      - echo "โ All services started"

  svc:stop:
    desc: "โน๏ธ Stop ALL Remote Services"
    cmds:
      - task: svc:scale:stop
      - task: svc:ticket:stop
      - echo "โ All services stopped"

  svc:restart:
    desc: "๐ Restart ALL Remote Services"
    cmds:
      - task: svc:scale:restart
      - task: svc:ticket:restart
      - echo "โ All services restarted"

  svc:status:
    desc: "๐ Check status of ALL Remote Services"
    cmds:
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ๏ธ  SCALE SERVICE ({{.SCALE_SVC_ID_REMOTE}})"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - cmd: sc query {{.SCALE_SVC_ID_REMOTE}}
        ignore_error: true
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  ๐ซ TICKET SERVICE ({{.TICKET_SVC_ID_REMOTE}})"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - cmd: sc query {{.TICKET_SVC_ID_REMOTE}}
        ignore_error: true

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐ฆ INSTALLER SERVICE BUILDS (Output to assets/bin)
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  installer:build:scale-local:
    desc: "๐ฆ Build Scale Service (Local) for embedding"
    dir: "{{.SCALE_SRC}}"
    deps: [ init:assets ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -H=windowsgui -X main.BuildEnvironment=local -X main.ServiceName={{.SCALE_SVC_ID_LOCAL}}" -o "{{.ASSETS_BIN_DIR}}/R2k_BasculaServicio_Local.exe" ./cmd/BasculaServicio
      - echo "โ Built R2k_BasculaServicio_Local.exe for installer"

  installer:build:scale-remote:
    desc: "๐ฆ Build Scale Service (Remote) for embedding"
    dir: "{{.SCALE_SRC}}"
    deps: [ init:assets ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_SCALE_BASE}} -H=windowsgui -X main.BuildEnvironment=remote -X main.ServiceName={{.SCALE_SVC_ID_REMOTE}}" -o "{{.ASSETS_BIN_DIR}}/R2k_BasculaServicio_Remote.exe" ./cmd/BasculaServicio
      - echo "โ Built R2k_BasculaServicio_Remote.exe for installer"

  installer:build:ticket-local:
    desc: "๐ฆ Build Ticket Service (Local) for embedding"
    dir: "{{.TICKET_SRC}}"
    deps: [ init:assets ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -H=windowsgui -X {{.TICKET_MODULE}}.BuildEnvironment=test" -o "{{.ASSETS_BIN_DIR}}/R2k_TicketServicio_Local.exe" ./cmd/TicketServicio
      - echo "โ Built R2k_TicketServicio_Local.exe for installer"

  installer:build:ticket-remote:
    desc: "๐ฆ Build Ticket Service (Remote) for embedding"
    dir: "{{.TICKET_SRC}}"
    deps: [ init:assets ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_TICKET_BASE}} -H=windowsgui -X {{.TICKET_MODULE}}.BuildEnvironment=prod" -o "{{.ASSETS_BIN_DIR}}/R2k_TicketServicio_Remote.exe" ./cmd/TicketServicio
      - echo "โ Built R2k_TicketServicio_Remote.exe for installer"

  installer:build:services:
    desc: "๐ฆ Build ALL service binaries for embedding (4 total)"
    cmds:
      - task: installer:build:scale-local
      - task: installer:build:scale-remote
      - task: installer:build:ticket-local
      - task: installer:build:ticket-remote
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ All service binaries ready for embedding"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

  installer:build:
    desc: "๐ Build TUI Installer with embedded services"
    deps: [ installer:build:services, init:dist ]
    cmds:
      - go build -ldflags "{{.LDFLAGS_INSTALLER}}" -o "{{.DIST_DIR}}/R2k_Instalador.exe" ./cmd/R2kInstaller
      - echo ""
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
      - echo "  โ INSTALLER BUILD COMPLETE"
      - echo "  ๐ Output:{{.DIST_DIR}}/R2k_Instalador.exe"
      - echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

  installer:rebuild:
    desc: "๐ Clean and rebuild installer from scratch"
    cmds:
      - task: clean:installer
      - task: installer:build

  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  # ๐งน UTILITIES
  # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  clean:
    desc: "๐งน Remove bin directory"
    cmds:
      - cmd: powershell -Command "if (Test-Path '{{.BIN_DIR}}') { Remove-Item -Recurse -Force '{{.BIN_DIR}}' -ErrorAction SilentlyContinue }"
        platforms: [ windows ]
      - cmd: rm -rf {{.BIN_DIR}}
        platforms: [ linux, darwin ]
      - echo "โ Cleaned {{.BIN_DIR}}"

  clean:installer:
    desc: "๐งน Clean installer build artifacts"
    cmds:
      - cmd: powershell -Command "if (Test-Path '{{.ASSETS_BIN_DIR}}') { Remove-Item -Recurse -Force '{{.ASSETS_BIN_DIR}}' -ErrorAction SilentlyContinue }"
        platforms: [ windows ]
      - cmd: powershell -Command "if (Test-Path '{{.DIST_DIR}}') { Remove-Item -Recurse -Force '{{.DIST_DIR}}' -ErrorAction SilentlyContinue }"
        platforms: [ windows ]
      - echo "โ Cleaned installer artifacts"

  clean:all:
    desc: "๐งน Clean all project bin and tmp directories"
    cmds:
      - task: clean
      - task: clean:installer
      - cmd: powershell -Command "Remove-Item -Path '../scale-daemon/bin', '../scale-daemon/tmp', '../ticket-daemon/bin' -Recurse -Force -ErrorAction SilentlyContinue"
        platforms: [ windows ]
      - cmd: rm -rf ../scale-daemon/bin ../ticket-daemon/bin
        platforms: [ linux, darwin ]
      - echo "โ All projects cleaned"